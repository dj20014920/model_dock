import{B as o}from"./browser-polyfill-5e752e65.js";import{p as w,A as g}from"./user-config-da123802.js";var l={};/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */l.parse=v;l.serialize=b;var y=Object.prototype.toString,u=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function v(e,r){if(typeof e!="string")throw new TypeError("argument str must be a string");for(var a={},t=r||{},s=t.decode||T,n=0;n<e.length;){var i=e.indexOf("=",n);if(i===-1)break;var c=e.indexOf(";",n);if(c===-1)c=e.length;else if(c<i){n=e.lastIndexOf(";",i-1)+1;continue}var f=e.slice(n,i).trim();if(a[f]===void 0){var p=e.slice(i+1,c).trim();p.charCodeAt(0)===34&&(p=p.slice(1,-1)),a[f]=E(p,s)}n=c+1}return a}function b(e,r,a){var t=a||{},s=t.encode||S;if(typeof s!="function")throw new TypeError("option encode is invalid");if(!u.test(e))throw new TypeError("argument name is invalid");var n=s(r);if(n&&!u.test(n))throw new TypeError("argument val is invalid");var i=e+"="+n;if(t.maxAge!=null){var c=t.maxAge-0;if(isNaN(c)||!isFinite(c))throw new TypeError("option maxAge is invalid");i+="; Max-Age="+Math.floor(c)}if(t.domain){if(!u.test(t.domain))throw new TypeError("option domain is invalid");i+="; Domain="+t.domain}if(t.path){if(!u.test(t.path))throw new TypeError("option path is invalid");i+="; Path="+t.path}if(t.expires){var f=t.expires;if(!k(f)||isNaN(f.valueOf()))throw new TypeError("option expires is invalid");i+="; Expires="+f.toUTCString()}if(t.httpOnly&&(i+="; HttpOnly"),t.secure&&(i+="; Secure"),t.partitioned&&(i+="; Partitioned"),t.priority){var p=typeof t.priority=="string"?t.priority.toLowerCase():t.priority;switch(p){case"low":i+="; Priority=Low";break;case"medium":i+="; Priority=Medium";break;case"high":i+="; Priority=High";break;default:throw new TypeError("option priority is invalid")}}if(t.sameSite){var m=typeof t.sameSite=="string"?t.sameSite.toLowerCase():t.sameSite;switch(m){case!0:i+="; SameSite=Strict";break;case"lax":i+="; SameSite=Lax";break;case"strict":i+="; SameSite=Strict";break;case"none":i+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}}return i}function T(e){return e.indexOf("%")!==-1?decodeURIComponent(e):e}function S(e){return encodeURIComponent(e)}function k(e){return y.call(e)==="[object Date]"||e instanceof Date}function E(e,r){try{return r(e)}catch{return e}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,r){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,r),r)}};const h="twitter-csrf-token";async function C({refresh:e}={}){if(!e){const{[h]:a}=await o.storage.session.get(h);if(a)return a}const r=await o.tabs.create({url:"https://about.twitter.com/en/404",active:!1});try{const a=await o.scripting.executeScript({target:{tabId:r.id},func:()=>document.cookie,injectImmediately:!0}),s=l.parse(a[0].result||"").ct0||"";return await o.storage.session.set({[h]:s}),s}finally{await o.tabs.remove(r.id)}}globalThis.jotaiAtomCache=globalThis.jotaiAtomCache||{cache:new Map,get(e,r){return this.cache.has(e)?this.cache.get(e):(this.cache.set(e,r),r)}};chrome.storage.session.setAccessLevel({accessLevel:"TRUSTED_AND_UNTRUSTED_CONTEXTS"});async function d(){const e=await o.tabs.query({}),r=o.runtime.getURL("app.html"),a=e.find(n=>{var i;return(i=n.url)==null?void 0:i.startsWith(r)});if(a){await o.tabs.update(a.id,{active:!0});return}const{startupPage:t}=await w(),s=t===g?"":`#/chat/${t}`;await o.tabs.create({url:`app.html${s}`})}o.action.onClicked.addListener(()=>{d()});o.runtime.onInstalled.addListener(e=>{e.reason==="install"&&o.tabs.create({url:"app.html#/setting"})});o.commands.onCommand.addListener(async e=>{e==="open-app"&&d()});o.runtime.onMessage.addListener(async(e,r)=>{if(e.target==="background"&&e.type==="read-twitter-csrf-token")return C(e.data)});
