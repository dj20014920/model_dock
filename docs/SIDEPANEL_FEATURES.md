# 사이드패널 기능 가이드

## 개요

ModelDock의 사이드패널은 Chrome 브라우저의 사이드바에서 여러 AI 모델을 동시에 사용할 수 있는 프리미엄 기능입니다. 메인 화면의 모든 핵심 기능을 컴팩트한 형태로 제공합니다.

## 주요 기능

### 1. 멀티 모델 지원
- **2개 레이아웃**: 2개의 AI 모델을 세로로 배치
- **3개 레이아웃**: 3개의 AI 모델을 세로로 배치
- **4개 레이아웃**: 4개의 AI 모델을 2x2 그리드로 배치

### 2. 메시지 전송 모드

#### Manual 모드 (수동 복사/붙여넣기)
- 프롬프트가 자동으로 클립보드에 복사됨
- 각 패널의 입력창에 직접 붙여넣기 (Ctrl+V)
- 법적 리스크 최소화
- Grok 등 iframe 기반 봇에도 안전하게 사용 가능

#### Auto 모드 (자동 라우팅)
- 모든 활성화된 봇에 자동으로 메시지 전송
- 첫 사용 시 리스크 동의 필요
- API 키 사용 시 안전
- 일부 봇(Grok 등)은 자동 건너뜀

### 3. 통합 입력창
- 하나의 입력창에서 모든 봇에 동시 전송
- 개별 봇 입력창도 사용 가능
- 실시간 토큰 사용량 추정 표시

### 4. 봇 전환
- 각 패널에서 독립적으로 봇 변경 가능
- 설정이 자동으로 저장됨
- 대화 기록은 봇별로 유지

### 5. 대화 관리
- 각 봇의 대화 초기화 기능
- 메시지 히스토리 표시
- 생성 중 메시지 중단 가능

## 사용 방법

### 사이드패널 열기
1. Chrome 브라우저에서 확장 프로그램 아이콘 클릭
2. 또는 단축키 사용 (기본: Alt+J / Mac: Cmd+J)
3. 사이드패널이 브라우저 오른쪽에 표시됨

### 레이아웃 변경
1. 하단의 레이아웃 아이콘 클릭
2. 2개, 3개, 4개 중 선택
3. 선택한 레이아웃이 자동 저장됨

### 메시지 전송
1. 하단 통합 입력창에 메시지 입력
2. Manual 모드: 클립보드에 복사 → 각 패널에 붙여넣기
3. Auto 모드: 자동으로 모든 봇에 전송

### 봇 변경
1. 각 패널 상단의 봇 이름 클릭
2. 드롭다운에서 원하는 봇 선택
3. 대화 기록은 유지됨

## 기술 구현

### 아키텍처
```
SidePanelPage (메인 컴포넌트)
├─ TwoBotPanel (2개 레이아웃)
├─ ThreeBotPanel (3개 레이아웃)
└─ FourBotPanel (4개 레이아웃)
    └─ SidePanelMultiBotPanel (공통 로직)
        ├─ ConversationPanel (각 봇 패널)
        ├─ LayoutSwitch (레이아웃 전환)
        ├─ ChatMessageInput (통합 입력창)
        └─ RiskConsentModal (리스크 동의)
```

### 상태 관리
- `sidePanelLayoutAtom`: 현재 레이아웃 (2, 3, 4)
- `sidePanelTwoBotsAtom`: 2개 레이아웃의 봇 설정
- `sidePanelThreeBotsAtom`: 3개 레이아웃의 봇 설정
- `sidePanelFourBotsAtom`: 4개 레이아웃의 봇 설정

### 메시지 전송 로직
```typescript
// Manual 모드
await startManualDispatch(input, botIds, mainBrainBotId)
// → 클립보드에 복사 + 토스트 알림

// Auto 모드
const result = await startAutoDispatch(input, botIds, mainBrainBotId, image)
// → DOM 이벤트 시뮬레이션으로 자동 입력
```

## 프리미엄 기능

사이드패널은 프리미엄 구독자 전용 기능입니다:
- 월 $5 구독 필요
- 무제한 템플릿 저장
- 무제한 메모장 저장
- 모든 레이아웃 사용 가능

비구독자는 업그레이드 안내 화면이 표시됩니다.

## 제한사항

### 지원하지 않는 기능
- 6개 레이아웃 (공간 제약)
- 이미지 입력 레이아웃 (공간 제약)
- 메인 브레인 패널 (메인 화면 전용)

### 봇별 제약
- **Grok**: Auto 모드 미지원 (iframe 보안 정책)
  - Manual 모드 사용 권장
  - iframe 내부 클릭 후 붙여넣기 필요

## 성능 최적화

### 컴팩트 UI
- 최소 공간으로 최대 정보 표시
- 스크롤바 최적화 (6px 너비)
- 반응형 그리드 레이아웃

### 메모리 관리
- 각 봇의 대화 기록 독립 관리
- 사용하지 않는 봇은 메모리 해제
- 레이아웃 변경 시 상태 보존

### 네트워크 최적화
- 메시지 전송 시 병렬 처리
- 실패한 봇 자동 건너뛰기
- 재시도 로직 내장

## 문제 해결

### 사이드패널이 열리지 않음
1. Chrome 버전 확인 (114 이상 필요)
2. 확장 프로그램 권한 확인
3. 브라우저 재시작

### 메시지가 전송되지 않음
1. 각 봇의 로그인 상태 확인
2. Manual 모드로 전환 시도
3. 개별 패널에서 직접 입력 테스트

### Grok이 작동하지 않음
1. Manual 모드 사용
2. Grok iframe 내부 클릭
3. Ctrl+V로 붙여넣기
4. X/Twitter 로그인 확인

## 향후 계획

### 예정된 기능
- [ ] 사이드패널 너비 조절
- [ ] 패널 순서 드래그 앤 드롭
- [ ] 즐겨찾기 레이아웃 저장
- [ ] 키보드 단축키 커스터마이징

### 개선 사항
- [ ] 더 빠른 메시지 전송
- [ ] 더 나은 오류 처리
- [ ] 더 많은 봇 지원

## 관련 문서

- [메인 화면 가이드](./MAIN_FEATURES.md)
- [메시지 전송 모드](./MESSAGE_DISPATCH.md)
- [메인 브레인 기능](./MAIN_BRAIN.md)
- [API 설정 가이드](./API_SETUP.md)
